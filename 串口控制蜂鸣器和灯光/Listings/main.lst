C51 COMPILER V9.54   MAIN                                                                  01/07/2023 12:17:39 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include <string.h>
   3          #include "Nixie.h"
   4          #include "Delay.h"
   5          #include "Key.h"
   6          #include "UART.h"
   7          #include "Buzzer.h"
   8          sbit Buzzer = P2^5;
   9          unsigned char mode=20,flag1=0,flag2=0,flag3=0,flag4=0,flag5=0,Time=0;
  10          void main()
  11          {
  12   1        UART_Init();    //串口初始化
  13   1        while(1)
  14   1        {
  15   2          if(mode==0)
  16   2          {
  17   3              Nixie(1,10);
  18   3              Nixie(2,11);
  19   3              Delay(20);
  20   3          }
  21   2          
  22   2              if(mode==1)
  23   2          {
  24   3              Nixie(1,10);
  25   3              Nixie(2,11);
  26   3              Delay(10);
  27   3            if(flag1)
  28   3            {
  29   4              UART_Sendstring("L1");
  30   4              flag1 = 0;
  31   4            }
  32   3          }
  33   2      
  34   2              if(mode==2)
  35   2          {
  36   3              Nixie(1,10);
  37   3              Nixie(2,11);
  38   3              Delay(5);
  39   3            if(flag2)
  40   3            {
  41   4              UART_Sendstring("L2");
  42   4              flag2 = 0;
  43   4            }
  44   3          }
  45   2      
  46   2              if(mode==3)
  47   2          {
  48   3              Nixie(1,10);
  49   3              Nixie(2,11);
  50   3            if(flag3)
  51   3            {
  52   4              UART_Sendstring("L3");
  53   4              flag3 = 0;
  54   4            }
C51 COMPILER V9.54   MAIN                                                                  01/07/2023 12:17:39 PAGE 2   

  55   3          }
  56   2      
  57   2            if(mode==4)
  58   2            {
  59   3              Nixie(1,16);
  60   3              Nixie(2,16);
  61   3              if(flag4)
  62   3              {
  63   4                UART_Sendstring("BEEPON!");
  64   4                for(Time=0;Time<100;Time++)
  65   4                {
  66   5                    Buzzer_Time(Time);
  67   5                    Delay(10);
  68   5                    Buzzer = 0;
  69   5                    Delay(100-Time);
  70   5                }
  71   4              }
  72   3              Buzzer=!Buzzer;
  73   3              Buzzer_Delay500us();
  74   3              flag4 = 0;
  75   3            }
  76   2            
  77   2            if(mode==5)
  78   2            {
  79   3              Nixie(1,16);
  80   3              Nixie(2,16);
  81   3              if(flag5)
  82   3              {
  83   4                UART_Sendstring("BEEPOFF!");
  84   4                for(Time=100;Time>0;Time--)
  85   4                {
  86   5                    Buzzer_Time(Time);
  87   5                    Delay(10);
  88   5                    Buzzer = 0;
  89   5                    Delay(100-Time);
  90   5                }
  91   4              }
  92   3              Buzzer = 0;
  93   3              flag5 = 0;
  94   3            }
  95   2      
  96   2        }
  97   1      }
  98          
  99          void UART_Routine() interrupt 4
 100          {
 101   1        unsigned char bytedata = '\0';
 102   1        static unsigned char str[32] = {'\0'},str1[5] = "dim",str2[10] = "BEEPON",str3[10] = "BEEPOFF",cnt=0;
 103   1        if(RI==1)
 104   1        {
 105   2          bytedata = SBUF;
 106   2          if(bytedata != '\n')
 107   2          {
 108   3            strncat(str,&bytedata,1);
 109   3            cnt++;
 110   3          }
 111   2          else
 112   2          {
 113   3            memset(str,'\0',sizeof(str));
 114   3            cnt = 0;
 115   3          }
 116   2            
C51 COMPILER V9.54   MAIN                                                                  01/07/2023 12:17:39 PAGE 3   

 117   2          if(cnt==3)
 118   2          {
 119   3            if(strcmp(str,str1)==0)
 120   3            {
 121   4              mode = 0;
 122   4              cnt = 0;
 123   4      //        memset(str,'\0',sizeof(str));
 124   4            }
 125   3          }
 126   2          
 127   2          if(cnt==2)
 128   2          {
 129   3            if(str[0]=='L')
 130   3            {
 131   4              switch (str[1])
 132   4              {
 133   5                case '1':
 134   5                  mode = 1;
 135   5                  cnt = 0;
 136   5                  flag1 = 1;
 137   5                  break;
 138   5                case '2':
 139   5                  mode = 2;
 140   5                  cnt = 0;
 141   5                  flag2 = 1;
 142   5                  break;
 143   5                case '3':
 144   5                  mode = 3;
 145   5                  cnt = 0;
 146   5                  flag3 = 1;
 147   5                  break;
 148   5              }
 149   4      //        memset(str,'\0',sizeof(str));
 150   4            }
 151   3          }
 152   2          
 153   2          if(cnt==6)
 154   2          {
 155   3            if(strcmp(str,str2)==0)
 156   3            {
 157   4              mode = 4;
 158   4              cnt = 0;
 159   4              flag4 = 1;
 160   4      //        memset(str,'\0',sizeof(str));
 161   4            }
 162   3          }
 163   2          
 164   2          if(cnt==7)
 165   2          {
 166   3            if(strcmp(str,str3)==0)
 167   3            {
 168   4              mode = 5;
 169   4              cnt = 0;
 170   4              flag5 = 1;
 171   4      //        memset(str,'\0',sizeof(str));
 172   4            }
 173   3          }
 174   2          
 175   2          RI=0;
 176   2        }
 177   1      }

C51 COMPILER V9.54   MAIN                                                                  01/07/2023 12:17:39 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    601    ----
   CONSTANT SIZE    =     26    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     65       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
